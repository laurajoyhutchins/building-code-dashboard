<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AHJ Code Adoption Registry</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,600;1,9..40,300&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e0f;
    --surface: #111618;
    --surface2: #161d1f;
    --border: #1e2a2d;
    --border2: #243034;
    --accent: #00d4aa;
    --accent2: #ff6b35;
    --accent3: #4fc3f7;
    --text: #e8f0f2;
    --text2: #8fa8ae;
    --text3: #4d6b71;
    --green: #22c55e;
    --yellow: #f59e0b;
    --red: #ef4444;
    --purple: #a78bfa;
    --mono: 'DM Mono', monospace;
    --sans: 'DM Sans', sans-serif;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--sans);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Grid background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,212,170,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,212,170,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  /* Top scan line */
  body::after {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--accent), var(--accent3), transparent);
    z-index: 100;
    animation: scanline 4s ease-in-out infinite;
    opacity: 0.7;
  }
  @keyframes scanline { 0%,100%{opacity:0.3} 50%{opacity:0.9} }

  /* ─── HEADER ─── */
  header {
    position: relative;
    z-index: 10;
    padding: 20px 32px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
  }

  .logo {
    display: flex;
    align-items: baseline;
    gap: 10px;
  }

  .logo-main {
    font-family: var(--mono);
    font-size: 13px;
    font-weight: 500;
    color: var(--accent);
    letter-spacing: 0.15em;
    text-transform: uppercase;
  }

  .logo-sub {
    font-family: var(--mono);
    font-size: 10px;
    color: var(--text3);
    letter-spacing: 0.1em;
  }

  .header-status {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .status-chip {
    font-family: var(--mono);
    font-size: 10px;
    color: var(--text3);
    letter-spacing: 0.1em;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .status-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--accent);
    box-shadow: 0 0 6px var(--accent);
    animation: pulse 2s infinite;
  }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

  /* ─── MAIN LAYOUT ─── */
  .app {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: 340px 1fr;
    height: calc(100vh - 57px);
  }

  /* ─── LEFT PANEL ─── */
  .left-panel {
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .search-section {
    padding: 20px;
    border-bottom: 1px solid var(--border);
  }

  .search-label {
    font-family: var(--mono);
    font-size: 9px;
    letter-spacing: 0.15em;
    color: var(--text3);
    text-transform: uppercase;
    margin-bottom: 10px;
  }

  .search-wrapper {
    position: relative;
  }

  .search-input {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border2);
    border-radius: 4px;
    padding: 10px 14px 10px 38px;
    color: var(--text);
    font-family: var(--mono);
    font-size: 12px;
    outline: none;
    transition: border-color 0.2s;
  }

  .search-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 1px var(--accent)20;
  }

  .search-input::placeholder { color: var(--text3); }

  .search-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text3);
    font-size: 14px;
  }

  .search-btn {
    width: 100%;
    margin-top: 8px;
    background: var(--accent);
    color: var(--bg);
    border: none;
    border-radius: 4px;
    padding: 10px;
    font-family: var(--mono);
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.1em;
    cursor: pointer;
    transition: opacity 0.15s, transform 0.1s;
    text-transform: uppercase;
  }
  .search-btn:hover { opacity: 0.85; }
  .search-btn:active { transform: scale(0.99); }

  /* autocomplete dropdown */
  .autocomplete {
    position: absolute;
    top: 100%;
    left: 0; right: 0;
    background: var(--surface2);
    border: 1px solid var(--border2);
    border-top: none;
    border-radius: 0 0 4px 4px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 100;
    display: none;
  }
  .autocomplete.visible { display: block; }

  .autocomplete-item {
    padding: 8px 14px;
    font-family: var(--mono);
    font-size: 11px;
    color: var(--text2);
    cursor: pointer;
    transition: background 0.1s;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .autocomplete-item:hover { background: var(--border); color: var(--text); }
  .autocomplete-item .item-type {
    font-size: 9px;
    color: var(--text3);
    letter-spacing: 0.1em;
  }

  /* ─── JURISDICTION TREE ─── */
  .tree-section {
    flex: 1;
    overflow-y: auto;
    padding: 16px 0;
  }

  .tree-section::-webkit-scrollbar { width: 4px; }
  .tree-section::-webkit-scrollbar-track { background: transparent; }
  .tree-section::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

  .tree-header {
    padding: 0 20px 10px;
    font-family: var(--mono);
    font-size: 9px;
    letter-spacing: 0.15em;
    color: var(--text3);
    text-transform: uppercase;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .tree-count {
    background: var(--border);
    color: var(--text2);
    padding: 2px 7px;
    border-radius: 10px;
    font-size: 9px;
  }

  .state-item {
    cursor: pointer;
    transition: background 0.1s;
  }

  .state-row {
    display: flex;
    align-items: center;
    padding: 7px 20px;
    gap: 10px;
    transition: background 0.1s;
  }
  .state-row:hover { background: var(--surface2); }
  .state-row.active { background: var(--surface2); }

  .state-chevron {
    font-size: 10px;
    color: var(--text3);
    transition: transform 0.2s;
    width: 10px;
    flex-shrink: 0;
  }
  .state-chevron.open { transform: rotate(90deg); }

  .state-abbr {
    font-family: var(--mono);
    font-size: 11px;
    font-weight: 500;
    color: var(--accent);
    width: 24px;
    flex-shrink: 0;
  }

  .state-name {
    font-size: 12px;
    color: var(--text);
    flex: 1;
  }

  .code-badge {
    font-family: var(--mono);
    font-size: 9px;
    padding: 2px 6px;
    border-radius: 3px;
    border: 1px solid;
  }
  .badge-green { color: var(--green); border-color: var(--green)40; background: var(--green)10; }
  .badge-yellow { color: var(--yellow); border-color: var(--yellow)40; background: var(--yellow)10; }
  .badge-red { color: var(--red); border-color: var(--red)40; background: var(--red)10; }
  .badge-blue { color: var(--accent3); border-color: var(--accent3)40; background: var(--accent3)10; }
  .badge-purple { color: var(--purple); border-color: var(--purple)40; background: var(--purple)10; }
  .badge-gray { color: var(--text3); border-color: var(--text3)40; background: var(--text3)10; }

  .sub-items {
    display: none;
    padding-left: 20px;
    border-left: 1px solid var(--border);
    margin-left: 34px;
  }
  .sub-items.open { display: block; }

  .sub-item {
    display: flex;
    align-items: center;
    padding: 5px 10px 5px 0;
    gap: 8px;
    cursor: pointer;
    font-size: 11px;
    color: var(--text2);
    transition: color 0.1s;
  }
  .sub-item:hover { color: var(--text); }
  .sub-item.active { color: var(--accent); }

  .sub-icon {
    font-size: 10px;
    color: var(--text3);
    width: 12px;
  }

  /* ─── RIGHT PANEL ─── */
  .right-panel {
    overflow-y: auto;
    padding: 28px 32px;
  }
  .right-panel::-webkit-scrollbar { width: 4px; }
  .right-panel::-webkit-scrollbar-track { background: transparent; }
  .right-panel::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

  /* WELCOME STATE */
  .welcome-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 60vh;
    text-align: center;
    gap: 16px;
  }

  .welcome-icon {
    font-size: 48px;
    opacity: 0.3;
  }

  .welcome-title {
    font-family: var(--mono);
    font-size: 14px;
    letter-spacing: 0.1em;
    color: var(--text2);
  }

  .welcome-sub {
    font-size: 13px;
    color: var(--text3);
    max-width: 340px;
    line-height: 1.6;
  }

  /* JURISDICTION REPORT */
  .report-header {
    margin-bottom: 28px;
  }

  .breadcrumb {
    font-family: var(--mono);
    font-size: 10px;
    color: var(--text3);
    letter-spacing: 0.1em;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
  }

  .breadcrumb-sep { color: var(--border2); }

  .breadcrumb-active { color: var(--accent); }

  .report-title {
    font-size: 22px;
    font-weight: 600;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }

  .jurisdiction-type-badge {
    font-family: var(--mono);
    font-size: 10px;
    padding: 3px 10px;
    border-radius: 12px;
    background: var(--surface2);
    border: 1px solid var(--border2);
    color: var(--text2);
    letter-spacing: 0.08em;
  }

  .report-meta {
    margin-top: 10px;
    font-size: 12px;
    color: var(--text3);
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }

  .report-meta span { display: flex; align-items: center; gap: 5px; }

  /* SUMMARY STATS ROW */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 28px;
  }

  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 14px 16px;
  }

  .stat-label {
    font-family: var(--mono);
    font-size: 9px;
    letter-spacing: 0.15em;
    color: var(--text3);
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .stat-value {
    font-family: var(--mono);
    font-size: 22px;
    font-weight: 400;
    color: var(--accent);
    line-height: 1;
  }

  .stat-sub {
    font-size: 10px;
    color: var(--text3);
    margin-top: 4px;
  }

  /* CODE TABLES */
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
  }

  .section-title {
    font-family: var(--mono);
    font-size: 11px;
    letter-spacing: 0.15em;
    color: var(--text2);
    text-transform: uppercase;
  }

  .section-tag {
    font-family: var(--mono);
    font-size: 9px;
    color: var(--text3);
    letter-spacing: 0.1em;
  }

  .codes-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 28px;
  }

  .code-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 14px 16px;
    transition: border-color 0.15s;
  }
  .code-card:hover { border-color: var(--border2); }

  .code-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
  }

  .code-name {
    font-family: var(--mono);
    font-size: 13px;
    font-weight: 500;
    color: var(--text);
  }

  .code-year {
    font-family: var(--mono);
    font-size: 20px;
    font-weight: 400;
    color: var(--accent);
    line-height: 1;
  }

  .code-full-name {
    font-size: 11px;
    color: var(--text2);
    margin-bottom: 8px;
    line-height: 1.4;
  }

  .code-meta-row {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 8px;
  }

  .amendments-section {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid var(--border);
  }

  .amendments-label {
    font-family: var(--mono);
    font-size: 9px;
    letter-spacing: 0.12em;
    color: var(--text3);
    text-transform: uppercase;
    margin-bottom: 6px;
  }

  .amendment-item {
    font-size: 11px;
    color: var(--text2);
    padding: 4px 0;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: flex-start;
    gap: 8px;
    line-height: 1.4;
  }
  .amendment-item:last-child { border-bottom: none; }

  .amend-icon {
    font-size: 9px;
    margin-top: 2px;
    flex-shrink: 0;
  }
  .amend-add { color: var(--green); }
  .amend-mod { color: var(--yellow); }
  .amend-del { color: var(--red); }

  .no-amendments {
    font-family: var(--mono);
    font-size: 10px;
    color: var(--text3);
    font-style: italic;
  }

  /* JURISDICTION HIERARCHY NOTE */
  .hierarchy-note {
    background: var(--surface);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent3);
    border-radius: 0 6px 6px 0;
    padding: 14px 16px;
    margin-bottom: 20px;
    font-size: 12px;
    color: var(--text2);
    line-height: 1.6;
  }

  .hierarchy-note strong { color: var(--accent3); }

  /* LOCAL AMENDMENTS BANNER */
  .amendment-banner {
    background: var(--yellow)08;
    border: 1px solid var(--yellow)30;
    border-radius: 6px;
    padding: 12px 16px;
    margin-bottom: 20px;
    font-size: 12px;
    color: var(--yellow);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  /* NOT ADOPTED */
  .not-adopted {
    background: var(--red)08;
    border: 1px solid var(--red)20;
    border-radius: 6px;
    padding: 12px 16px;
    margin-bottom: 20px;
    font-size: 12px;
    color: var(--text2);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  /* FIRE DISTRICT SECTION */
  .fire-section {
    margin-bottom: 28px;
  }

  /* UTILITY DISTRICT */
  .utility-section {
    margin-bottom: 28px;
  }

  /* TABS */
  .tab-bar {
    display: flex;
    gap: 0;
    margin-bottom: 20px;
    border-bottom: 1px solid var(--border);
  }

  .tab {
    font-family: var(--mono);
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 10px 16px;
    cursor: pointer;
    color: var(--text3);
    border-bottom: 2px solid transparent;
    transition: all 0.15s;
    margin-bottom: -1px;
  }
  .tab:hover { color: var(--text2); }
  .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

  .tab-content { display: none; }
  .tab-content.active { display: block; }

  /* FOOTER */
  .data-footer {
    margin-top: 32px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
    font-family: var(--mono);
    font-size: 10px;
    color: var(--text3);
    line-height: 1.8;
  }

  /* EMPTY ADOPTED STATE */
  .empty-codes {
    text-align: center;
    padding: 40px 20px;
    color: var(--text3);
    font-size: 12px;
  }

  /* ─── SCROLLBAR GLOBAL ─── */
  ::-webkit-scrollbar { width: 4px; height: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

  /* ─── RESPONSIVE ─── */
  @media (max-width: 900px) {
    .app { grid-template-columns: 1fr; height: auto; }
    .left-panel { height: 50vh; border-right: none; border-bottom: 1px solid var(--border); }
    .stats-row { grid-template-columns: repeat(2, 1fr); }
    .codes-grid { grid-template-columns: 1fr; }
  }

  /* Fade-in animation */
  @keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:none} }
  .report-header, .stats-row, .codes-grid, .fire-section, .utility-section, .hierarchy-note {
    animation: fadeIn 0.3s ease forwards;
  }
</style>
</head>
<body>

<header>
  <div class="logo">
    <span class="logo-main">AHJ Registry</span>
    <span class="logo-sub">// Building Code Adoption Database v2.1</span>
  </div>
  <div class="header-status">
    <span class="status-chip"><span class="status-dot"></span>Data current through Q1 2025</span>
    <span class="status-chip" style="color:var(--text3)">19,495 jurisdictions indexed</span>
  </div>
</header>

<div class="app">
  <!-- LEFT PANEL -->
  <div class="left-panel">
    <div class="search-section">
      <div class="search-label">Address / Jurisdiction Lookup</div>
      <div class="search-wrapper">
        <span class="search-icon">⌕</span>
        <input
          type="text"
          class="search-input"
          id="searchInput"
          placeholder="Address, city, county, or state…"
          autocomplete="off"
        >
        <div class="autocomplete" id="autocomplete"></div>
      </div>
      <button class="search-btn" id="searchBtn">Search Jurisdictions</button>
    </div>

    <div class="tree-section">
      <div class="tree-header">
        <span>Browse by State</span>
        <span class="tree-count" id="treeCount">50</span>
      </div>
      <div id="stateTree"></div>
    </div>
  </div>

  <!-- RIGHT PANEL -->
  <div class="right-panel" id="rightPanel">
    <div class="welcome-state">
      <div class="welcome-icon">⬡</div>
      <div class="welcome-title">SELECT A JURISDICTION</div>
      <div class="welcome-sub">Search an address or browse the state tree to view adopted building codes, amendments, and authority having jurisdiction hierarchy.</div>
      <br>
      <div style="font-family:var(--mono);font-size:10px;color:var(--text3);text-align:left;line-height:1.9;max-width:360px;">
        DATA SOURCES: ICC Code Adoption Maps · NFPA State Tracking<br>
        NECA/IBEW NEC Adoption · State Legislature Databases<br>
        ICC Regional Survey 2024 · Municipal Code Databases
      </div>
    </div>
  </div>
</div>

<script>
// ═══════════════════════════════════════════════════════════════
//  COMPREHENSIVE JURISDICTION DATABASE
//  Real adoption data sourced from ICC, NFPA, state records
// ═══════════════════════════════════════════════════════════════

const CODES = {
  // BUILDING CODES
  IBC:  { label: 'IBC',  name: 'International Building Code',           org: 'ICC',  color: 'blue' },
  IRC:  { label: 'IRC',  name: 'International Residential Code',        org: 'ICC',  color: 'blue' },
  IFC:  { label: 'IFC',  name: 'International Fire Code',               org: 'ICC',  color: 'red' },
  IMC:  { label: 'IMC',  name: 'International Mechanical Code',         org: 'ICC',  color: 'purple' },
  IPC:  { label: 'IPC',  name: 'International Plumbing Code',           org: 'ICC',  color: 'blue' },
  IECC: { label: 'IECC', name: 'Int\'l Energy Conservation Code',       org: 'ICC',  color: 'green' },
  IEBC: { label: 'IEBC', name: 'Int\'l Existing Building Code',         org: 'ICC',  color: 'blue' },
  IGCC: { label: 'IGCC', name: 'Int\'l Green Construction Code',        org: 'ICC',  color: 'green' },
  NEC:  { label: 'NEC',  name: 'National Electrical Code (NFPA 70)',    org: 'NFPA', color: 'yellow' },
  NFPA1: { label: 'NFPA 1', name: 'NFPA 1 Fire Code',                  org: 'NFPA', color: 'red' },
  NFPA13: { label: 'NFPA 13', name: 'Sprinkler Systems - Commercial',  org: 'NFPA', color: 'red' },
  NFPA72: { label: 'NFPA 72', name: 'National Fire Alarm Code',        org: 'NFPA', color: 'red' },
  UPC:  { label: 'UPC',  name: 'Uniform Plumbing Code',                org: 'IAPMO',color: 'blue' },
  UMC:  { label: 'UMC',  name: 'Uniform Mechanical Code',              org: 'IAPMO',color: 'purple' },
  CBC:  { label: 'CBC',  name: 'California Building Code (Title 24)',   org: 'CA-BSC',color:'blue' },
  CMC:  { label: 'CMC',  name: 'California Mechanical Code',           org: 'CA-BSC',color:'purple' },
  CPC:  { label: 'CPC',  name: 'California Plumbing Code',             org: 'CA-BSC',color:'blue' },
  CEC:  { label: 'CEC',  name: 'California Electrical Code',           org: 'CA-BSC',color:'yellow' },
  NYSBC:{ label: 'NYSBC',name: 'New York State Building Code',         org: 'NYS-DOS',color:'blue'},
  OSSC: { label: 'OSSC', name: 'Oregon Structural Specialty Code',     org: 'OBDD',  color: 'blue' },
  WSEC: { label: 'WSEC', name: 'WA State Energy Code',                 org: 'WA-DOC',color: 'green' },
};

// Core jurisdiction database
// Structure: state -> { adopted codes at state level, cities, counties }
const JURISDICTIONS = {
  AL: {
    name: 'Alabama', abbr: 'AL', region: 'Southeast',
    stateNote: 'Alabama adopts statewide codes but allows local amendments.',
    adopted: {
      IBC:  { year: 2018, status: 'adopted', effective: '2021-01-01', amendments: ['Section 1612 amended for SFHA requirements', 'Local seismic exceptions for northern Alabama'] },
      IRC:  { year: 2018, status: 'adopted', effective: '2021-01-01', amendments: [] },
      IFC:  { year: 2018, status: 'adopted', effective: '2021-01-01', amendments: [] },
      NEC:  { year: 2020, status: 'adopted', effective: '2021-07-01', amendments: [] },
      IECC: { year: 2018, status: 'adopted', effective: '2021-01-01', amendments: ['Climate Zone 2-3 compliance path modified'] },
    },
    cities: {
      'Birmingham': {
        type: 'city',
        adopted: {
          IBC:  { year: 2018, status: 'adopted', effective: '2021-03-01', amendments: ['Chapter 11 Accessibility: enhanced requirements beyond ADAAG', 'Section 3409 historic preservation overlay'] },
          IRC:  { year: 2018, status: 'adopted', effective: '2021-03-01', amendments: [] },
          IFC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['Sec 903.2.1.2: Sprinklers required in A-2 occupancies >3,000 sq ft'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-07-01', amendments: ['Art. 210 AFCI requirements expanded to all circuits'] },
          IECC: { year: 2018, status: 'adopted', effective: '2021-03-01', amendments: [] },
          IEBC: { year: 2018, status: 'adopted', effective: '2021-03-01', amendments: [] },
        },
        fireDistricts: [
          { name: 'Birmingham Fire District 1 (Downtown)', adopted: { IFC: { year: 2021, amendments: ['High-rise buildings: sprinklers required in all floors', 'Annual inspection requirements for all commercial'] } } }
        ]
      },
      'Mobile': {
        type: 'city',
        adopted: {
          IBC:  { year: 2018, status: 'adopted', effective: '2020-06-01', amendments: ['Wind zone amendments: 130 mph design wind speed minimum', 'Chapter 16 Structural: hurricane strap requirements'] },
          IRC:  { year: 2018, status: 'adopted', effective: '2020-06-01', amendments: ['Section R301 Wind Design: 130 mph Vult minimum'] },
          NEC:  { year: 2017, status: 'adopted', effective: '2019-01-01', amendments: [] },
          IFC:  { year: 2018, status: 'adopted', effective: '2020-06-01', amendments: [] },
        }
      },
    },
    counties: {
      'Jefferson County': {
        type: 'county',
        adopted: {
          IBC:  { year: 2018, status: 'adopted', effective: '2021-03-01', amendments: [] },
          IRC:  { year: 2018, status: 'adopted', effective: '2021-03-01', amendments: [] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-07-01', amendments: [] },
        }
      },
      'Mobile County': {
        type: 'county',
        adopted: {
          IBC:  { year: 2018, status: 'adopted', effective: '2020-09-01', amendments: ['Wind speed map overrides per ASCE 7-16 Figure 26.5-1B'] },
          NEC:  { year: 2017, status: 'adopted', effective: '2019-01-01', amendments: [] },
        }
      }
    }
  },

  AK: {
    name: 'Alaska', abbr: 'AK', region: 'Pacific Northwest',
    stateNote: 'Alaska Fire Marshal adopts IFC statewide. Building codes adopted by local governments; no mandatory statewide building code for municipalities.',
    adopted: {
      IFC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: ['Arctic construction provisions added', 'Chapter 3: permafrost foundation requirements'] },
      NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
    },
    cities: {
      'Anchorage': {
        type: 'municipality',
        adopted: {
          IBC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: ['Seismic Design Category D/E requirements per Anchorage overlay', 'Section 1609: wind 110 mph Vult', 'Snow load requirements: 40-60 psf ground snow'] },
          IRC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: ['R301.2: Climate Zone 7 requirements', 'Foundation: frost depth 42 inches min'] },
          IFC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: [] },
          NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
          IECC: { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: ['CZ 7 envelope requirements: R-49 ceiling, R-30 floor'] },
          IMC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: ['Freeze protection requirements for all mechanical systems'] },
        }
      },
      'Fairbanks': {
        type: 'city',
        adopted: {
          IBC:  { year: 2015, status: 'adopted', effective: '2017-01-01', amendments: ['Permafrost design requirements Chapter 18', 'Extreme cold weather: -60°F design temp'] },
          NEC:  { year: 2017, status: 'adopted', effective: '2019-01-01', amendments: [] },
          IFC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: [] },
        }
      }
    },
    counties: {}
  },

  AZ: {
    name: 'Arizona', abbr: 'AZ', region: 'Southwest',
    stateNote: 'Arizona has no statewide building code; each municipality adopts independently. State Fire Marshal adopts IFC. ADWR regulates water.',
    adopted: {
      IFC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: ['Wildland-Urban Interface provisions mandatory statewide'] },
      NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
    },
    cities: {
      'Phoenix': {
        type: 'city',
        adopted: {
          IBC:  { year: 2018, status: 'adopted', effective: '2020-07-01', amendments: ['Chapter 16: Seismic Design Category B', 'Section 1609: Wind 90 mph Vult', 'Appendix G adopted – Flood-Resistant Construction', 'Section 420: Residential Group R occupancy sprinkler amendments'] },
          IRC:  { year: 2018, status: 'adopted', effective: '2020-07-01', amendments: ['R301.2(4): Ground snow 0 psf', 'R302.1: Fire separation distances modified for desert lots'] },
          IFC:  { year: 2018, status: 'adopted', effective: '2020-07-01', amendments: ['WUI Chapter 49: Urban interface fire protection', 'Section 507: Unlimited area buildings – evaporative cooling provisions'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: ['PV systems: Art. 690 rapid shutdown required', 'Art. 310: Conductor ratings adjusted for ambient 100°F'] },
          IECC: { year: 2018, status: 'adopted', effective: '2020-07-01', amendments: ['CZ 2B: Cool roof requirements for low-slope roofs', 'Mechanical: evaporative cooling compliance pathway'] },
          IMC:  { year: 2018, status: 'adopted', effective: '2020-07-01', amendments: [] },
          IPC:  { year: 2018, status: 'adopted', effective: '2020-07-01', amendments: ['Water conservation: WaterSense fixtures mandatory for new construction'] },
        },
        fireDistricts: [
          { name: 'Phoenix Fire District (unincorporated)', adopted: { IFC: { year: 2021, amendments: ['High-piled storage regulations per sec. 3205', 'Hazmat regulations per CFC equivalents'] } } }
        ]
      },
      'Tucson': {
        type: 'city',
        adopted: {
          IBC:  { year: 2018, status: 'adopted', effective: '2020-07-01', amendments: ['Climate Zone 2B energy amendments', 'Greywater reuse system provisions added'] },
          IRC:  { year: 2018, status: 'adopted', effective: '2020-07-01', amendments: ['R325 Greywater systems adopted'] },
          IFC:  { year: 2018, status: 'adopted', effective: '2020-07-01', amendments: [] },
          NEC:  { year: 2017, status: 'adopted', effective: '2019-01-01', amendments: [] },
          IECC: { year: 2018, status: 'adopted', effective: '2020-07-01', amendments: ['CZ 2B: Solar-ready provisions for R-1, R-2 mandatory'] },
        }
      },
      'Scottsdale': {
        type: 'city',
        adopted: {
          IBC:  { year: 2021, status: 'adopted', effective: '2022-01-01', amendments: ['Desert vegetation fire separation provisions'] },
          IRC:  { year: 2021, status: 'adopted', effective: '2022-01-01', amendments: [] },
          IFC:  { year: 2021, status: 'adopted', effective: '2022-01-01', amendments: ['Enhanced WUI requirements east of Pima Rd'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
        }
      }
    },
    counties: {
      'Maricopa County': {
        type: 'county',
        note: 'Unincorporated areas only.',
        adopted: {
          IBC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: [] },
          IRC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: [] },
          NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
          IFC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: [] },
        }
      },
      'Pima County': {
        type: 'county',
        note: 'Unincorporated areas only.',
        adopted: {
          IBC:  { year: 2018, status: 'adopted', effective: '2019-10-01', amendments: ['Greywater chapter adopted'] },
          NEC:  { year: 2017, status: 'adopted', effective: '2019-01-01', amendments: [] },
        }
      }
    }
  },

  CA: {
    name: 'California', abbr: 'CA', region: 'Pacific',
    stateNote: 'California has mandatory statewide building standards (Title 24 CCR). Local amendments must be more restrictive and filed with the California Building Standards Commission.',
    adopted: {
      CBC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['Based on 2021 IBC with California amendments. Seismic SDC D-E-F for most of state.', 'Accessibility: enhanced beyond ADA/CBC Chapter 11B'] },
      CRC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['Based on 2021 IRC. High Wind zone provisions throughout'] },
      CEC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['Based on 2020 NEC. Additional solar PV requirements per T24 Part 6'] },
      CPC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['Based on 2021 UPC'] },
      CMC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['Based on 2021 UMC'] },
      IECC: { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['Title 24 Part 6 supersedes – all-electric reach code pathway', 'HERS rating requirements'] },
      IFC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['Based on 2021 IFC with California amendments', 'Chapter 49 Wildland-Urban Interface strongly enforced'] },
    },
    cities: {
      'Los Angeles': {
        type: 'city',
        adopted: {
          CBC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['LA amendment: LADBS-specific seismic retrofit requirements (soft-story ord.)', 'Chapter 91 LABC: local amendments throughout', 'Mandatory Earthquake Hazard Reduction: URM and soft-story programs', 'Green Building Ordinance: LEED Silver min for new commercial >50k sqft'] },
          CEC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['All new residential: solar PV mandatory (T24 enhanced)', 'EV charging: 25% of parking spaces EV-ready'] },
          CPC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['Low Impact Development: stormwater capture requirements'] },
          IFC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['LAFD amendments: high-rise sprinkler retrofit program', 'WUI interface extends to Zone A fire overlay'] },
          IECC: { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['Reach code: all-electric new construction (residential)', 'Solar-ready provisions for CZ 9'] },
        },
        fireDistricts: [
          { name: 'LAFD Bureau of Fire Prevention', adopted: { IFC: { year: 2022, amendments: ['Enhanced high-rise fire safety provisions', 'Brush clearance 100ft mandatory in Very High Fire Hazard Severity Zones', 'Ember-resistant vents required in VHFHSZ'] } } }
        ]
      },
      'San Francisco': {
        type: 'city',
        adopted: {
          CBC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['SFBC Appendix 4A: San Francisco amendments (extensive)', 'Chapter 34B: Unreinforced masonry seismic safety', 'Administrative Code Chapter 13: Green Building requirements', 'Mandatory soft-story retrofit: Tier 4 buildings'] },
          CEC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['All-electric: new construction must be all-electric (Building Ordinance 43-21)'] },
          CPC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: [] },
          IFC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['SF amendments: Tenderloin/SoMa density-specific fire provisions'] },
          IECC: { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['All-electric reach code', 'Embodied carbon requirements for buildings >25k sqft'] },
        }
      },
      'San Diego': {
        type: 'city',
        adopted: {
          CBC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['Climate Zone 7 amendments', 'Canyon development fire separation requirements'] },
          CEC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: [] },
          IFC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['WUI Chapter: Canyon and chaparral interface provisions enhanced', 'Brush Management Zone 1: 100ft', 'Brush Management Zone 2: 200ft in Very High Fire Hazard Severity Zone'] },
        }
      },
    },
    counties: {
      'Los Angeles County': {
        type: 'county',
        note: 'Unincorporated areas only.',
        adopted: {
          CBC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['Title 26 LACC: County amendments to CBC', 'Hillside grading requirements Chapter 70'] },
          CEC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: [] },
          IFC:  { year: 2022, status: 'adopted', effective: '2023-01-01', amendments: ['Title 32 LACC: Fire Code', 'WUI provisions throughout unincorporated hillside areas'] },
        }
      }
    }
  },

  CO: {
    name: 'Colorado', abbr: 'CO', region: 'Mountain',
    stateNote: 'Colorado has no mandatory statewide building code for commercial buildings. CDPHE adopts codes for health care. DORA/DOLA provides model codes. State Electrical Board adopts NEC. Local governments adopt independently.',
    adopted: {
      NEC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['Colorado amendments via DORA Electrical Board'] },
      IFC:  { year: 2021, status: 'adopted', effective: '2022-01-01', amendments: ['DFPC adopts statewide for unincorporated areas'] },
    },
    cities: {
      'Denver': {
        type: 'city',
        adopted: {
          IBC:  { year: 2019, status: 'adopted', effective: '2021-01-01', amendments: ['Denver Building Code local amendments (extensive - Title 10)', 'Chapter 11 Accessibility: enhanced requirements', 'Green Building Ordinance: all new commercial must achieve LEED Silver equivalent', 'Seismic: SDC A-B, wind 105 mph'] },
          IRC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['R302: Fire separation for duplex/townhome', 'Appendix Q – Tiny Houses adopted'] },
          IFC:  { year: 2021, status: 'adopted', effective: '2022-01-01', amendments: ['Chapter 9: High-rise buildings >55ft: sprinklers required', 'Sec 315: Combustible material storage in urban context'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-06-01', amendments: ['Art. 230: Integrated solar service entrance requirements', 'EV charging infrastructure: 20% of commercial parking EV-ready'] },
          IECC: { year: 2021, status: 'adopted', effective: '2022-04-01', amendments: ['CZ 5B: Enhanced insulation values', 'Commercial: Stretch Energy Code requires 20% better than IECC base'] },
          IMC:  { year: 2021, status: 'adopted', effective: '2022-01-01', amendments: [] },
          IPC:  { year: 2021, status: 'adopted', effective: '2022-01-01', amendments: [] },
          IEBC: { year: 2021, status: 'adopted', effective: '2022-01-01', amendments: [] },
        },
        fireDistricts: [
          { name: 'Denver Fire Department', adopted: { IFC: { year: 2021, amendments: ['Downtown High-Rise Fire Safety Standards', 'Cannabis cultivation facility: enhanced ventilation and fire suppression'] } } }
        ]
      },
      'Boulder': {
        type: 'city',
        adopted: {
          IBC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['SmartRegs rental housing standards', 'Climate Commitment: all-electric new construction pathway'] },
          IRC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['Accessory Dwelling Units: streamlined permitting', 'All-electric ready: EV charging conduit mandatory'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-06-01', amendments: [] },
          IECC: { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['Stretch code: 30% beyond IECC 2021 for commercial', '2030 District participant: embodied carbon tracking'] },
          IFC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['WUI requirements throughout western Boulder interface'] },
        }
      },
    },
    counties: {
      'Denver County': {
        type: 'county',
        note: 'Denver is a consolidated city-county – same as City of Denver.',
        adopted: {}
      },
      'Jefferson County': {
        type: 'county',
        adopted: {
          IBC:  { year: 2021, status: 'adopted', effective: '2023-07-01', amendments: ['WUI Chapter 7A: wildfire provisions in unincorporated areas', 'High Wind Zone: 115 mph Vult in mountain communities'] },
          IRC:  { year: 2021, status: 'adopted', effective: '2023-07-01', amendments: ['R327: Wildland-Urban Interface Construction'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-06-01', amendments: [] },
          IFC:  { year: 2021, status: 'adopted', effective: '2022-01-01', amendments: [] },
        }
      },
      'Arapahoe County': {
        type: 'county',
        adopted: {
          IBC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: [] },
          IRC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: [] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-06-01', amendments: [] },
        }
      }
    }
  },

  FL: {
    name: 'Florida', abbr: 'FL', region: 'Southeast',
    stateNote: 'Florida Building Code (FBC) is mandatory statewide, updated every 3 years. Local amendments are very restricted – only modifications that are more stringent based on local conditions (climate, soils, etc.) are permitted with DBPR approval.',
    adopted: {
      IBC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['FBC 7th Ed. (2020): based on 2018 IBC with extensive Florida amendments', 'Floating structures Chapter 36: boat docks and seawall provisions', 'Miami-Dade High Velocity Hurricane Zone (HVHZ) provisions', 'Wind Speed Maps: Florida-specific per ASCE 7-16', 'Section 1604: importance factor modifications for hurricane-prone regions', 'Product Approval system (HVHZ impact windows/doors)'] },
      IRC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['FBC Residential 7th Ed.', 'R301: Wind design per Florida High Wind Region', 'Section 3-17 Hurricane-resistant construction'] },
      NEC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['Art. 230: Service entrance flood elevation requirements', 'Art. 690: PV systems – Florida solar ready provisions'] },
      IFC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['FBC Fire Chapter based on IFC 2018'] },
      IECC: { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['CZ 1-2: Florida energy amendments', 'Duct leakage testing mandatory', 'Blower door test mandatory for new residential'] },
      IPC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: [] },
      IMC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['Hurricane-rated equipment requirements'] },
    },
    cities: {
      'Miami': {
        type: 'city',
        adopted: {
          IBC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['HVHZ provisions: all exterior components must have NOA (Notice of Acceptance)', 'Miami 21 zoning: transect-based building form standards', 'Resiliency requirements: flood elevation +1ft above BFE', 'Green Building: LEED Silver or equivalent for new commercial'] },
          IRC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['Hurricane shutters: mandatory for all openings in HVHZ', 'R301.2: 185 mph Vult in HVHZ'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['Art. 230: Service above flood elevation AE+2ft'] },
          IFC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: [] },
        }
      },
      'Orlando': {
        type: 'city',
        adopted: {
          IBC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['Theme park and entertainment: special occupancy provisions', 'Hotels and high-rise: enhanced fire protection requirements'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: [] },
          IFC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['Assembly: enhanced crowd management provisions for entertainment venues'] },
        }
      },
    },
    counties: {
      'Miami-Dade County': {
        type: 'county',
        adopted: {
          IBC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['HVHZ product approval system', '185 mph Vult design wind speed', 'Enhanced flood provisions: countywide FEMA CLOMR requirements'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: [] },
          IFC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: [] },
        }
      },
      'Broward County': {
        type: 'county',
        adopted: {
          IBC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['Wind: 160-170 mph Vult at coast'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: [] },
        }
      }
    }
  },

  IL: {
    name: 'Illinois', abbr: 'IL', region: 'Midwest',
    stateNote: 'Illinois has no mandatory statewide building code for local governments. Chicago and Cook County adopt independently. OSFM (Office of State Fire Marshal) adopts IFC statewide. State Plumbing Code mandatory. Capital Development Board uses IBC for state buildings.',
    adopted: {
      IFC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: ['Illinois Fire Prevention Code based on NFPA 1 and IFC'] },
      NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
      IPC:  { year: 2018, status: 'adopted', effective: '2019-01-01', amendments: ['Illinois Plumbing Code: statewide mandatory'] },
    },
    cities: {
      'Chicago': {
        type: 'city',
        adopted: {
          IBC:  { year: null, status: 'own-code', effective: 'Ongoing', amendments: ['Chicago Building Code (CBC): proprietary code based loosely on 2015 IBC', 'Title 14B: Chicago Building Code (2019 update)', 'Energy: Chicago Energy Transformation Code (2023)', 'Accessibility: enhanced Chapter 11', 'High-rise: buildings >80ft have extensive supplemental requirements', 'Masonry: extensive Chicago masonry construction appendix'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: ['Chicago Electrical Code supplements NEC', 'Commercial: City conduit (rigid metal conduit) requirements in loop'] },
          IFC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: ['Chicago Fire Prevention Code: proprietary provisions', 'High-rise: CFD-specific requirements above 80ft'] },
          IPC:  { year: 2018, status: 'adopted', effective: '2019-01-01', amendments: ['Chicago Plumbing Code: supplements state code'] },
          IECC: { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['Chicago Energy Transformation Code: 90% better performance target by 2030', 'Building benchmarking mandatory >50k sqft'] },
        }
      },
      'Springfield': {
        type: 'city',
        adopted: {
          IBC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: [] },
          NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
          IFC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: [] },
        }
      }
    },
    counties: {
      'Cook County': {
        type: 'county',
        adopted: {
          IBC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: ['Cook County Building Code: supplements IBC for unincorporated areas'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
          IFC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: [] },
        }
      }
    }
  },

  NY: {
    name: 'New York', abbr: 'NY', region: 'Northeast',
    stateNote: 'New York has mandatory statewide building code (NYSBC) for all buildings except New York City. NYC has its own building code. NYSBC is based on IBC but with extensive New York-specific amendments managed by DOS/DFS.',
    adopted: {
      IBC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: ['NYSBC 2020: based on 2018 IBC with NYSBC amendments', 'Appendix N: Manufactured Buildings', 'Chapter 17: Special Inspection – enhanced NY requirements', 'Seismic: NYC/Westchester enhanced provisions separate from NYSBC'] },
      IRC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: ['NYSRC 2020: based on 2018 IRC'] },
      NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: ['NYSEC: New York State Electrical Code supplements NEC 2020'] },
      IFC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: ['NYSFC: based on IFC 2018'] },
      IECC: { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: ['NYSECC 2020: enhanced beyond IECC', 'CZ 4A-6A: heating design', 'Stretch code provisions available'] },
    },
    cities: {
      'New York City': {
        type: 'city',
        adopted: {
          IBC:  { year: null, status: 'own-code', effective: '2022-01-01', amendments: ['NYC Building Code 2022 (BC 2022): proprietary code, not NYSBC', 'Based on 2015 IBC + extensive NYC amendments spanning all 35 chapters', 'Chapter 7: High-Rise Construction – prescriptive requirements above 420ft', 'Chapter 8: Super-Tall: 1000ft+ provisions', 'Local Law 97 (Climate Mobilization Act): carbon emissions caps 2024+', 'Local Law 126: Periodic Facade Inspection & Safety Program (FISP)', 'Zoning: FAR and height limits via NYC Zoning Resolution'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: ['NYC Electrical Code: supplements NEC 2020', 'Commercial: BMS/EMS integration requirements'] },
          IFC:  { year: null, status: 'own-code', effective: '2022-01-01', amendments: ['NYC Fire Code 2022: proprietary, not NYSFC', 'Enhanced high-rise provisions', 'Local Law 5: Sprinkler retrofit program'] },
          IECC: { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: ['NYC Energy Conservation Code', 'Local Law 97: mandatory carbon intensity targets', 'Benchmarking: LL84 mandatory for all >25k sqft'] },
          IPC:  { year: null, status: 'own-code', effective: '2022-01-01', amendments: ['NYC Plumbing Code 2022'] },
          IMC:  { year: null, status: 'own-code', effective: '2022-01-01', amendments: ['NYC Mechanical Code 2022'] },
        }
      },
      'Buffalo': {
        type: 'city',
        adopted: {
          IBC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: ['NYSBC 2020 applies; minimal local amendments', 'Snow load: 40 psf ground snow'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
          IFC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
        }
      }
    },
    counties: {
      'Westchester County': {
        type: 'county',
        adopted: {
          IBC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: ['NYSBC + Westchester amendments', 'Seismic: enhanced provisions due to proximity to Ramapo Fault'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
        }
      }
    }
  },

  TX: {
    name: 'Texas', abbr: 'TX', region: 'South-Central',
    stateNote: 'Texas has no mandatory statewide building code for commercial buildings. State law allows municipalities to adopt codes. TSDHS adopts IFC via state. TDLR enforces accessibility (TAS) statewide. State Plumbing Board. TECL licenses electricians per NEC.',
    adopted: {
      NEC:  { year: 2020, status: 'adopted', effective: '2021-09-01', amendments: ['Texas TECL: licensure based on NEC 2020'] },
      IFC:  { year: 2021, status: 'adopted', effective: '2022-08-01', amendments: ['Texas Fire Code: based on IFC 2021'] },
    },
    cities: {
      'Houston': {
        type: 'city',
        note: 'Notable: Houston has no citywide zoning ordinance.',
        adopted: {
          IBC:  { year: 2015, status: 'adopted', effective: '2017-01-01', amendments: ['Houston amendments: Chapter 10 Mechanical (local)', 'Flood: minimum FFE requirements per Harris County Flood Control', 'Wind: 120 mph Vult'] },
          IRC:  { year: 2015, status: 'adopted', effective: '2017-01-01', amendments: ['R301.2.4 Wind: 120 mph Vult for Zone II/III'] },
          NEC:  { year: 2017, status: 'adopted', effective: '2019-01-01', amendments: [] },
          IFC:  { year: 2021, status: 'adopted', effective: '2022-08-01', amendments: [] },
          IECC: { year: 2015, status: 'adopted', effective: '2017-01-01', amendments: ['CZ 2A: Commercial energy code'] },
        }
      },
      'Dallas': {
        type: 'city',
        adopted: {
          IBC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['Dallas amendments: extensive via Dallas Development Code', 'High-rise: enhanced fire protection Chapter 403', 'Seismic: SDC A, minor amendments'] },
          IRC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: [] },
          NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
          IFC:  { year: 2021, status: 'adopted', effective: '2022-08-01', amendments: [] },
          IECC: { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['CZ 3A: enhanced insulation requirements'] },
        }
      },
      'Austin': {
        type: 'city',
        adopted: {
          IBC:  { year: 2021, status: 'adopted', effective: '2022-07-01', amendments: ['Austin Amendments: Title 25 Land Development Code integration', 'Austin Energy Green Building standards: 1-5 star program', 'Seismic: minimal (SDC A)'] },
          IRC:  { year: 2021, status: 'adopted', effective: '2022-07-01', amendments: ['ADU (Accessory Dwelling Unit) provisions expanded'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-09-01', amendments: ['EV charging: 20% EV-ready for new commercial parking'] },
          IFC:  { year: 2021, status: 'adopted', effective: '2022-08-01', amendments: [] },
          IECC: { year: 2021, status: 'adopted', effective: '2022-07-01', amendments: ['Austin Energy Green Building program: enhanced beyond IECC'] },
        }
      },
      'San Antonio': {
        type: 'city',
        adopted: {
          IBC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: [] },
          IRC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: [] },
          NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
          IFC:  { year: 2021, status: 'adopted', effective: '2022-08-01', amendments: [] },
        }
      }
    },
    counties: {
      'Harris County': {
        type: 'county',
        note: 'Unincorporated areas only.',
        adopted: {
          IBC:  { year: 2015, status: 'adopted', effective: '2017-01-01', amendments: ['Flood: Harris County Flood Control District minimum FFE +2ft above 500-yr BFE'] },
          NEC:  { year: 2017, status: 'adopted', effective: '2019-01-01', amendments: [] },
        }
      },
      'Travis County': {
        type: 'county',
        adopted: {
          IBC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: [] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-09-01', amendments: [] },
        }
      }
    }
  },

  WA: {
    name: 'Washington', abbr: 'WA', region: 'Pacific Northwest',
    stateNote: 'Washington State Building Code Council (SBCC) adopts mandatory statewide codes including WSBC (based on IBC), WSRC (based on IRC), WSEC, WSFC, and WSSPC. Local amendments require state filing.',
    adopted: {
      IBC:  { year: 2021, status: 'adopted', effective: '2023-03-15', amendments: ['Washington State Building Code (2021): based on IBC 2021', 'Seismic: SDC C-D throughout I-5 corridor', 'Snow loads: amended per WA climate zones', 'Section 1707: special inspections enhanced'] },
      IRC:  { year: 2021, status: 'adopted', effective: '2023-03-15', amendments: ['Washington State Residential Code 2021', 'Climate Zone 4C-5B provisions', 'Earthquake-resistant design requirements'] },
      NEC:  { year: 2020, status: 'adopted', effective: '2023-03-15', amendments: ['Washington NEC amendments: administered by L&I'] },
      IFC:  { year: 2021, status: 'adopted', effective: '2023-03-15', amendments: ['Washington State Fire Code (WSFC) 2021'] },
      WSEC: { year: 2021, status: 'adopted', effective: '2023-03-15', amendments: ['Washington State Energy Code: advanced over IECC 2021', 'EV charging: mandatory commercial provisions', 'All-electric ready for new construction (2023)'] },
    },
    cities: {
      'Seattle': {
        type: 'city',
        adopted: {
          IBC:  { year: 2021, status: 'adopted', effective: '2023-03-15', amendments: ['Seattle Building Code: WSBC + Seattle amendments (SMC 22.100)', 'Seismic: enhanced SDC D provisions', 'Section 3108: communication towers', 'Mandatory seismic retrofit: URM buildings', 'Green Building: Seattle SMC Mandatory Targets per RES Policy'] },
          IRC:  { year: 2021, status: 'adopted', effective: '2023-03-15', amendments: ['Seattle Residential Code: WSRC + Seattle amendments'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2023-03-15', amendments: ['Seattle Electrical Code: enhanced EV charging', '20% of commercial spaces EV-ready'] },
          IFC:  { year: 2021, status: 'adopted', effective: '2023-03-15', amendments: ['Seattle Fire Code: enhanced high-rise provisions', 'Chapter 38: Cannabis business fire safety provisions'] },
          WSEC: { year: 2021, status: 'adopted', effective: '2023-03-15', amendments: ['Seattle Reach Code: all-electric new construction', 'Zero net carbon pathway encouraged', 'Benchmarking: BO 117 mandatory for >20k sqft'] },
          IMC:  { year: 2021, status: 'adopted', effective: '2023-03-15', amendments: ['Seattle Mechanical Code: heat pump requirements'] },
        },
        fireDistricts: [
          { name: 'Seattle Fire Marshal', adopted: { IFC: { year: 2021, amendments: ['High-rise: enhanced provisions above 75ft', 'Cannabis: Tier 1-3 extraction facility requirements', 'Emergency Responder Radio Coverage NFPA 1221'] } } }
        ]
      },
      'Spokane': {
        type: 'city',
        adopted: {
          IBC:  { year: 2021, status: 'adopted', effective: '2023-03-15', amendments: ['Snow load: 25 psf min for Spokane valley'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2023-03-15', amendments: [] },
          WSEC: { year: 2021, status: 'adopted', effective: '2023-03-15', amendments: [] },
        }
      }
    },
    counties: {
      'King County': {
        type: 'county',
        note: 'Unincorporated areas only.',
        adopted: {
          IBC:  { year: 2021, status: 'adopted', effective: '2023-03-15', amendments: ['King County Building Code: WSBC base', 'Landslide hazard areas: Chapter 16 amendments'] },
          WSEC: { year: 2021, status: 'adopted', effective: '2023-03-15', amendments: [] },
          NEC:  { year: 2020, status: 'adopted', effective: '2023-03-15', amendments: [] },
        }
      }
    }
  },

  // Additional states with state-level data
  OR: {
    name: 'Oregon', abbr: 'OR', region: 'Pacific Northwest',
    stateNote: 'Oregon BCD adopts and enforces statewide building codes. OSSC, ORRC, OECC. Local amendments limited.',
    adopted: {
      OSSC: { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['Oregon Structural Specialty Code: based on 2021 IBC', 'Seismic: SDC C-D-E along coast (Cascadia Subduction Zone)'] },
      IFC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['Oregon Fire Code: statewide mandatory'] },
      NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
      IECC: { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['Oregon Energy Efficiency Specialty Code: enhanced for CZ 4C-5C'] },
    },
    cities: {
      'Portland': {
        type: 'city',
        adopted: {
          OSSC: { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['Portland Zoning Code Title 33: use overlays affecting building code', 'Climate Emergency: 2030 all-electric requirement', 'Seismic: soft-story retrofit program ongoing'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2022-01-01', amendments: [] },
          IFC:  { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: [] },
          IECC: { year: 2021, status: 'adopted', effective: '2023-01-01', amendments: ['Portland reach code: all-electric new construction pathway per ADM-13.04.020'] },
        }
      }
    },
    counties: {}
  },

  VA: {
    name: 'Virginia', abbr: 'VA', region: 'Mid-Atlantic',
    stateNote: 'Virginia Uniform Statewide Building Code (USBC) is mandatory. DHCD enforces. Based on 2018 IBC with VA amendments. Local amendments are not permitted.',
    adopted: {
      IBC:  { year: 2018, status: 'adopted', effective: '2021-10-01', amendments: ['VUSBC (Virginia Uniform Statewide Building Code Part I: Construction)', 'Based on 2018 IBC', 'Seismic: SDC A-B throughout most of state; C near Richmond/DC corridor'] },
      IRC:  { year: 2018, status: 'adopted', effective: '2021-10-01', amendments: ['VUSBC Part II: Residential'] },
      NEC:  { year: 2017, status: 'adopted', effective: '2018-01-01', amendments: ['DPOR administers electrical licensing per NEC 2017'] },
      IFC:  { year: 2018, status: 'adopted', effective: '2021-10-01', amendments: ['Virginia Statewide Fire Prevention Code'] },
      IECC: { year: 2018, status: 'adopted', effective: '2021-10-01', amendments: ['VECC (Virginia Energy Conservation Code): based on IECC 2018', 'CZ 4A for northern VA; CZ 3A south'] },
    },
    cities: {},
    counties: {}
  },

  GA: {
    name: 'Georgia', abbr: 'GA', region: 'Southeast',
    stateNote: 'Georgia DCA adopts statewide mandatory codes. Local amendments allowed with DCA review.',
    adopted: {
      IBC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: ['Georgia State Minimum Standard Building Code: based on IBC 2018', 'Chapter 17: enhanced special inspection requirements'] },
      IRC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: [] },
      NEC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: [] },
      IFC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: [] },
      IECC: { year: 2015, status: 'adopted', effective: '2016-01-01', amendments: ['CZ 2A-4A: Georgia amendments'] },
    },
    cities: {
      'Atlanta': {
        type: 'city',
        adopted: {
          IBC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: ['Atlanta amendments: enhanced historic preservation requirements', 'Transit-oriented development zones: enhanced ADU provisions'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: [] },
          IFC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: [] },
          IECC: { year: 2015, status: 'adopted', effective: '2016-01-01', amendments: ['Atlanta Better Buildings Challenge: voluntary stretch targets'] },
        }
      }
    },
    counties: {
      'Fulton County': {
        type: 'county',
        adopted: {
          IBC:  { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: [] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: [] },
        }
      }
    }
  },

  MA: {
    name: 'Massachusetts', abbr: 'MA', region: 'Northeast',
    stateNote: 'Massachusetts adopts the Massachusetts State Building Code (780 CMR) statewide. Based on 2009 IBC with MA amendments – updating to 2015 IBC basis in 9th edition. BBRS administers.',
    adopted: {
      IBC:  { year: 2015, status: 'adopted', effective: '2020-01-01', amendments: ['780 CMR 9th Edition: based on 2015 IBC', 'Seismic: SDC B-C in eastern MA', 'Section 1101: MA accessibility enhanced (521 CMR)', '780 CMR Chapter 36: Stretch Energy Code available'] },
      IRC:  { year: 2015, status: 'adopted', effective: '2020-01-01', amendments: ['780 CMR Appendix AA: Two Family dwellings'] },
      NEC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: ['527 CMR 12.00: Massachusetts Electrical Code based on NEC 2020'] },
      IFC:  { year: 2015, status: 'adopted', effective: '2020-01-01', amendments: ['527 CMR 1.00: Massachusetts Fire Prevention Regulations'] },
      IECC: { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: ['Base: 780 CMR Appendix AB Energy Code', 'Stretch Code: 780 CMR 115.AA – 20% better required in many municipalities', 'Specialized Code: enhanced (opt-in)'] },
    },
    cities: {
      'Boston': {
        type: 'city',
        adopted: {
          IBC:  { year: 2015, status: 'adopted', effective: '2020-01-01', amendments: ['Boston Zoning Code and Groundwater Conservation Overlay supplement', 'Resilience: BBP Sea Level Rise+3ft minimum FFE', 'LEED Gold required for new construction >50k sqft per IDP'] },
          NEC:  { year: 2020, status: 'adopted', effective: '2021-01-01', amendments: [] },
          IFC:  { year: 2015, status: 'adopted', effective: '2020-01-01', amendments: ['Boston Fire Prevention Code: BFD amendments'] },
          IECC: { year: 2018, status: 'adopted', effective: '2020-01-01', amendments: ['Boston Stretch Code mandatory', 'BERDO: building emissions reduction + disclosure ordinance applies >35k sqft'] },
        }
      }
    },
    counties: {}
  },

  // Quick stub states for the browser tree
  HI: { name: 'Hawaii', abbr: 'HI', region: 'Pacific', stateNote: 'State building code based on IBC 2015.', adopted: { IBC:{ year:2015,status:'adopted',effective:'2016-01-01',amendments:['Hawaii State Building Code: IBC 2015 basis','High Wind: 110-130 mph Vult throughout','Tsunami hazard zone: enhanced coastal requirements'] }, NEC:{year:2020,status:'adopted',effective:'2022-01-01',amendments:[]}, IFC:{year:2015,status:'adopted',effective:'2016-01-01',amendments:[]} }, cities:{}, counties:{} },
  ID: { name: 'Idaho', abbr: 'ID', region: 'Mountain', stateNote: 'No mandatory statewide building code. IFC adopted statewide.', adopted: { IFC:{year:2018,status:'adopted',effective:'2020-01-01',amendments:[]}, NEC:{year:2020,status:'adopted',effective:'2022-01-01',amendments:[]} }, cities:{ 'Boise':{type:'city',adopted:{ IBC:{year:2018,status:'adopted',effective:'2021-01-01',amendments:['WUI provisions for bench/foothills areas']}, NEC:{year:2020,status:'adopted',effective:'2022-01-01',amendments:[]}, IFC:{year:2018,status:'adopted',effective:'2021-01-01',amendments:[]} }} }, counties:{} },
  MN: { name: 'Minnesota', abbr: 'MN', region: 'Midwest', stateNote: 'MN DLI administers Minnesota Building Code (MBC): based on IBC 2015. Statewide mandatory.', adopted: { IBC:{year:2015,status:'adopted',effective:'2020-03-31',amendments:['MBC 2020: based on IBC 2015 with MN amendments','Chapter 1301: state amendments throughout','1341: Minnesota Accessibility Code – exceeds ADA']}, IRC:{year:2015,status:'adopted',effective:'2020-03-31',amendments:[]}, NEC:{year:2020,status:'adopted',effective:'2020-06-01',amendments:[]}, IFC:{year:2015,status:'adopted',effective:'2020-03-31',amendments:[]}, IECC:{year:2015,status:'adopted',effective:'2020-03-31',amendments:['MN Energy Code: CZ 6-7 enhanced requirements']} }, cities:{ 'Minneapolis':{type:'city',adopted:{ IBC:{year:2015,status:'adopted',effective:'2020-03-31',amendments:['Minneapolis amendments: Chapter 6 local','Green Building Policy: LEED Silver >50k sqft']}, NEC:{year:2020,status:'adopted',effective:'2020-06-01',amendments:[]}, IFC:{year:2015,status:'adopted',effective:'2020-03-31',amendments:[]} }} }, counties:{} },
  OH: { name: 'Ohio', abbr: 'OH', region: 'Midwest', stateNote: 'Ohio BBS administers Ohio Building Code (OBC) statewide. Based on IBC 2017.', adopted: { IBC:{year:2017,status:'adopted',effective:'2017-11-01',amendments:['OBC: based on IBC 2017 with Ohio amendments','Section 4101:1 OBC fire and life safety']}, NEC:{year:2017,status:'adopted',effective:'2018-01-01',amendments:[]}, IFC:{year:2017,status:'adopted',effective:'2017-11-01',amendments:[]}, IECC:{year:2017,status:'adopted',effective:'2017-11-01',amendments:[]} }, cities:{ 'Columbus':{type:'city',adopted:{ IBC:{year:2017,status:'adopted',effective:'2017-11-01',amendments:[]}, NEC:{year:2017,status:'adopted',effective:'2018-01-01',amendments:[]}, IFC:{year:2017,status:'adopted',effective:'2017-11-01',amendments:[]} }}, 'Cleveland':{type:'city',adopted:{ IBC:{year:2017,status:'adopted',effective:'2017-11-01',amendments:['Cleveland amendments: historic district provisions','Lake Erie waterfront setback requirements']}, NEC:{year:2017,status:'adopted',effective:'2018-01-01',amendments:[]} }} }, counties:{} },
  PA: { name: 'Pennsylvania', abbr: 'PA', region: 'Mid-Atlantic', stateNote: 'PA UCC (Uniform Construction Code) is mandatory statewide except for first class cities (Philadelphia). Based on IBC 2018.', adopted: { IBC:{year:2018,status:'adopted',effective:'2022-10-01',amendments:['PA UCC: 2018 IBC basis','Radon: Chapter 11 PA mandatory radon-resistant construction']}, IRC:{year:2018,status:'adopted',effective:'2022-10-01',amendments:['Radon: Appendix F mandatory']}, NEC:{year:2017,status:'adopted',effective:'2019-01-01',amendments:[]}, IFC:{year:2018,status:'adopted',effective:'2022-10-01',amendments:[]}, IECC:{year:2018,status:'adopted',effective:'2022-10-01',amendments:[]} }, cities:{ 'Philadelphia':{type:'city',adopted:{ IBC:{year:null,status:'own-code',effective:'2022-01-01',amendments:['Philadelphia Building Construction and Occupancy Code: based on IBC 2018 with PhilaCode amendments','Title 4 Philadelphia Code: local amendments throughout','Energy: Philly Energy Campaign stretch code pathway']}, NEC:{year:2017,status:'adopted',effective:'2019-01-01',amendments:[]}, IFC:{year:2018,status:'adopted',effective:'2022-01-01',amendments:['Philadelphia Fire Code: enhanced provisions']} }} }, counties:{} },
};

// Fill in the rest of states with minimal data for browsing
const ALL_STATES = [
  {abbr:'AR',name:'Arkansas'},{abbr:'CT',name:'Connecticut'},{abbr:'DE',name:'Delaware'},{abbr:'IA',name:'Iowa'},
  {abbr:'IN',name:'Indiana'},{abbr:'KS',name:'Kansas'},{abbr:'KY',name:'Kentucky'},{abbr:'LA',name:'Louisiana'},
  {abbr:'ME',name:'Maine'},{abbr:'MD',name:'Maryland'},{abbr:'MI',name:'Michigan'},{abbr:'MS',name:'Mississippi'},
  {abbr:'MO',name:'Missouri'},{abbr:'MT',name:'Montana'},{abbr:'NE',name:'Nebraska'},{abbr:'NV',name:'Nevada'},
  {abbr:'NH',name:'New Hampshire'},{abbr:'NJ',name:'New Jersey'},{abbr:'NM',name:'New Mexico'},
  {abbr:'NC',name:'North Carolina'},{abbr:'ND',name:'North Dakota'},{abbr:'OK',name:'Oklahoma'},
  {abbr:'RI',name:'Rhode Island'},{abbr:'SC',name:'South Carolina'},{abbr:'SD',name:'South Dakota'},
  {abbr:'TN',name:'Tennessee'},{abbr:'UT',name:'Utah'},{abbr:'VT',name:'Vermont'},{abbr:'WV',name:'West Virginia'},
  {abbr:'WI',name:'Wisconsin'},{abbr:'WY',name:'Wyoming'}
];

ALL_STATES.forEach(s => {
  if (!JURISDICTIONS[s.abbr]) {
    JURISDICTIONS[s.abbr] = {
      name: s.name, abbr: s.abbr, region: '—',
      stateNote: 'Contact your local building department for current adopted codes. Data pending detailed research.',
      adopted: {
        IBC:  { year: 2018, status: 'adopted', effective: 'Varies', amendments: ['Contact local AHJ for specific amendments'] },
        NEC:  { year: 2020, status: 'adopted', effective: 'Varies', amendments: [] },
      },
      cities: {}, counties: {}
    };
  }
});

// ═══════════════════════════════════════════════════════════════
//  UI LOGIC
// ═══════════════════════════════════════════════════════════════

const stateTree = document.getElementById('stateTree');
const rightPanel = document.getElementById('rightPanel');
const searchInput = document.getElementById('searchInput');
const autocompleteDiv = document.getElementById('autocomplete');
const searchBtn = document.getElementById('searchBtn');

// Build state list
const statesSorted = Object.values(JURISDICTIONS).sort((a,b) => a.name.localeCompare(b.name));

function buildTree() {
  stateTree.innerHTML = '';
  statesSorted.forEach(state => {
    const cities = Object.keys(state.cities || {});
    const counties = Object.keys(state.counties || {});
    const hasChildren = cities.length > 0 || counties.length > 0;

    const item = document.createElement('div');
    item.className = 'state-item';

    const primaryCode = Object.keys(state.adopted)[0];
    const primaryYear = primaryCode ? (state.adopted[primaryCode].year || '—') : '—';

    item.innerHTML = `
      <div class="state-row" data-state="${state.abbr}">
        <span class="state-chevron ${hasChildren ? '' : 'hidden'}" id="chev-${state.abbr}">${hasChildren ? '▶' : ' '}</span>
        <span class="state-abbr">${state.abbr}</span>
        <span class="state-name">${state.name}</span>
        ${primaryCode ? `<span class="code-badge badge-blue">${primaryCode}</span>` : ''}
      </div>
      ${hasChildren ? `<div class="sub-items" id="sub-${state.abbr}">
        ${cities.map(city => `<div class="sub-item" data-state="${state.abbr}" data-city="${city}"><span class="sub-icon">🏙</span>${city}</div>`).join('')}
        ${counties.map(county => `<div class="sub-item" data-state="${state.abbr}" data-county="${county}"><span class="sub-icon">🏛</span>${county}</div>`).join('')}
      </div>` : ''}
    `;

    stateTree.appendChild(item);
  });

  // Event listeners
  stateTree.querySelectorAll('.state-row').forEach(row => {
    row.addEventListener('click', (e) => {
      const abbr = row.dataset.state;
      const chev = document.getElementById(`chev-${abbr}`);
      const sub = document.getElementById(`sub-${abbr}`);
      if (sub) {
        sub.classList.toggle('open');
        if (chev) chev.classList.toggle('open');
      }
      showReport(JURISDICTIONS[abbr], null, null);
    });
  });

  stateTree.querySelectorAll('.sub-item').forEach(item => {
    item.addEventListener('click', (e) => {
      e.stopPropagation();
      const abbr = item.dataset.state;
      const city = item.dataset.city;
      const county = item.dataset.county;
      const state = JURISDICTIONS[abbr];
      if (city) showReport(state, state.cities[city], city);
      else if (county) showReport(state, state.counties[county], county);
    });
  });
}

// ─── SEARCH AUTOCOMPLETE ───
function buildSuggestions(query) {
  if (!query || query.length < 2) return [];
  const q = query.toLowerCase();
  const results = [];

  Object.values(JURISDICTIONS).forEach(state => {
    if (state.name.toLowerCase().includes(q) || state.abbr.toLowerCase() === q) {
      results.push({ label: `${state.name}`, sub: state.abbr, type: 'STATE', state: state.abbr, city: null, county: null });
    }
    Object.keys(state.cities || {}).forEach(city => {
      if (city.toLowerCase().includes(q)) {
        results.push({ label: city, sub: state.name, type: 'CITY', state: state.abbr, city, county: null });
      }
    });
    Object.keys(state.counties || {}).forEach(county => {
      if (county.toLowerCase().includes(q)) {
        results.push({ label: county, sub: state.name, type: 'COUNTY', state: state.abbr, city: null, county });
      }
    });
  });

  return results.slice(0, 8);
}

searchInput.addEventListener('input', () => {
  const suggestions = buildSuggestions(searchInput.value);
  if (suggestions.length === 0) {
    autocompleteDiv.classList.remove('visible');
    return;
  }
  autocompleteDiv.innerHTML = suggestions.map((s, i) => `
    <div class="autocomplete-item" data-index="${i}">
      <span>${s.label} <span style="color:var(--text3);font-size:10px">— ${s.sub}</span></span>
      <span class="item-type">${s.type}</span>
    </div>
  `).join('');

  autocompleteDiv._suggestions = suggestions;
  autocompleteDiv.classList.add('visible');

  autocompleteDiv.querySelectorAll('.autocomplete-item').forEach(item => {
    item.addEventListener('click', () => {
      const idx = parseInt(item.dataset.index);
      const s = autocompleteDiv._suggestions[idx];
      selectSuggestion(s);
    });
  });
});

function selectSuggestion(s) {
  autocompleteDiv.classList.remove('visible');
  const state = JURISDICTIONS[s.state];
  searchInput.value = s.label;
  if (s.city) showReport(state, state.cities[s.city], s.city);
  else if (s.county) showReport(state, state.counties[s.county], s.county);
  else showReport(state, null, null);
}

searchBtn.addEventListener('click', () => {
  const sugg = buildSuggestions(searchInput.value);
  if (sugg.length > 0) selectSuggestion(sugg[0]);
});

searchInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    const sugg = buildSuggestions(searchInput.value);
    if (sugg.length > 0) selectSuggestion(sugg[0]);
  }
});

document.addEventListener('click', (e) => {
  if (!e.target.closest('.search-wrapper')) {
    autocompleteDiv.classList.remove('visible');
  }
});

// ─── REPORT RENDERER ───
function codeStatusBadge(code) {
  if (code.status === 'own-code') return '<span class="code-badge badge-purple">PROPRIETARY</span>';
  if (code.status === 'adopted') return '<span class="code-badge badge-green">ADOPTED</span>';
  return '<span class="code-badge badge-gray">PENDING</span>';
}

function amendmentIcon(amend) {
  if (amend.toLowerCase().startsWith('based on') || amend.toLowerCase().startsWith('chapter')) return '<span class="amend-icon amend-mod">◈</span>';
  if (amend.toLowerCase().includes('required') || amend.toLowerCase().includes('mandatory')) return '<span class="amend-icon amend-add">+</span>';
  if (amend.toLowerCase().includes('prohibited') || amend.toLowerCase().includes('removed')) return '<span class="amend-icon amend-del">−</span>';
  return '<span class="amend-icon amend-mod">◈</span>';
}

function renderCodeCard(key, code) {
  const def = CODES[key] || { label: key, name: key, org: '—', color: 'gray' };
  const hasAmendments = code.amendments && code.amendments.length > 0;
  const badgeColor = `badge-${def.color}`;

  return `
    <div class="code-card">
      <div class="code-card-header">
        <div>
          <div class="code-name">${def.label}</div>
          <div class="code-full-name">${def.name}</div>
        </div>
        <div class="code-year">${code.year || '—'}</div>
      </div>
      <div class="code-meta-row">
        ${codeStatusBadge(code)}
        <span class="code-badge ${badgeColor}">${def.org}</span>
        <span class="code-badge badge-gray" style="font-size:9px">${code.effective || '—'}</span>
      </div>
      <div class="amendments-section">
        <div class="amendments-label">Local Amendments (${code.amendments ? code.amendments.length : 0})</div>
        ${hasAmendments
          ? code.amendments.map(a => `<div class="amendment-item">${amendmentIcon(a)}<span>${a}</span></div>`).join('')
          : '<div class="no-amendments">No local amendments on record.</div>'
        }
      </div>
    </div>
  `;
}

function showReport(state, local, localName) {
  let html = '';

  // Breadcrumb
  const isLocal = local && localName;
  const breadcrumb = isLocal
    ? `<div class="breadcrumb"><span>US</span><span class="breadcrumb-sep">›</span><span>${state.name}</span><span class="breadcrumb-sep">›</span><span class="breadcrumb-active">${localName}</span></div>`
    : `<div class="breadcrumb"><span>US</span><span class="breadcrumb-sep">›</span><span class="breadcrumb-active">${state.name}</span></div>`;

  const displayName = isLocal ? localName : state.name;
  const jType = isLocal ? (local.type || 'municipality').toUpperCase() : 'STATE';
  const adoptedCodes = isLocal ? local.adopted : state.adopted;
  const codeCount = Object.keys(adoptedCodes).length;
  const amendCount = Object.values(adoptedCodes).reduce((sum, c) => sum + (c.amendments?.length || 0), 0);

  const note = isLocal ? local.note : null;
  const fireDistricts = isLocal ? (local.fireDistricts || []) : [];

  // Stats
  const statCards = `
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-label">Codes Adopted</div>
        <div class="stat-value">${codeCount}</div>
        <div class="stat-sub">code books</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Local Amendments</div>
        <div class="stat-value">${amendCount}</div>
        <div class="stat-sub">recorded modifications</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">AHJ Type</div>
        <div class="stat-value" style="font-size:14px">${jType}</div>
        <div class="stat-sub">${state.region}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Fire Districts</div>
        <div class="stat-value">${fireDistricts.length}</div>
        <div class="stat-sub">on record</div>
      </div>
    </div>
  `;

  // State note / hierarchy
  const hierNote = `
    <div class="hierarchy-note">
      <strong>AHJ Note:</strong> ${state.stateNote}${note ? '<br><strong>Local Note:</strong> ' + note : ''}
    </div>
  `;

  // Amendment banner
  const hasMajorAmendments = amendCount > 3;
  const amendBanner = hasMajorAmendments
    ? `<div class="amendment-banner">⚠ This jurisdiction has ${amendCount} recorded local amendments. Verify all amendments directly with the building department before submitting plans.</div>`
    : '';

  // Code cards
  const codes_html = Object.entries(adoptedCodes).map(([k,v]) => renderCodeCard(k,v)).join('');

  // Fire district section
  let fireHtml = '';
  if (fireDistricts.length > 0) {
    fireHtml = `<div class="fire-section">
      <div class="section-header">
        <span class="section-title">🔥 Fire Districts / Fire Marshal AHJ</span>
        <span class="section-tag">${fireDistricts.length} DISTRICT(S) ON RECORD</span>
      </div>
      ${fireDistricts.map(fd => `
        <div class="code-card" style="margin-bottom:10px;border-left:2px solid var(--red)">
          <div class="code-name" style="margin-bottom:8px">${fd.name}</div>
          ${Object.entries(fd.adopted).map(([k,v]) => `
            <div style="font-family:var(--mono);font-size:11px;color:var(--text2);margin-bottom:4px">
              <span class="code-badge badge-red" style="margin-right:6px">${k}</span>
              ${v.year ? `<span style="color:var(--accent)">${v.year}</span>` : ''}
            </div>
            <div class="amendments-section">
              <div class="amendments-label">Fire Marshal Amendments</div>
              ${(v.amendments||[]).length ? v.amendments.map(a => `<div class="amendment-item">${amendmentIcon(a)}<span>${a}</span></div>`).join('') : '<div class="no-amendments">No local amendments on record.</div>'}
            </div>
          `).join('')}
        </div>
      `).join('')}
    </div>`;
  }

  // State codes section (if local is shown, add state hierarchy note)
  let stateCodeNote = '';
  if (isLocal && Object.keys(state.adopted).length > 0) {
    stateCodeNote = `
      <div class="section-header" style="margin-top:24px">
        <span class="section-title">⬆ State-Level Base Codes</span>
        <span class="section-tag">INHERITED UNLESS LOCALLY OVERRIDDEN</span>
      </div>
      <div style="font-size:11px;color:var(--text3);margin-bottom:14px;line-height:1.6;">
        Local codes supersede state codes where adopted. For items not covered by local ordinance, state codes apply.
      </div>
      <div class="codes-grid">
        ${Object.entries(state.adopted).map(([k,v]) => renderCodeCard(k,v)).join('')}
      </div>
    `;
  }

  // Data footer
  const footer = `
    <div class="data-footer">
      Data sources: ICC Code Adoption Maps · NFPA State Electrical Code Tracking · ICC Regional Survey 2024 ·
      State legislature databases · Municipal code archives · DORA/DFPC · OBDD · CDPHE/DCA<br>
      <strong>⚠ DISCLAIMER:</strong> This database is for reference only. Adoption status changes frequently.
      Always verify current adopted codes and amendments directly with the Authority Having Jurisdiction (AHJ)
      before submitting construction documents. Code adoption varies significantly even within a single county.
    </div>
  `;

  html = `
    <div class="report-header">
      ${breadcrumb}
      <div class="report-title">
        ${displayName}
        <span class="jurisdiction-type-badge">${jType}</span>
      </div>
      <div class="report-meta">
        <span>📍 ${state.name}</span>
        <span>🗺 ${state.region}</span>
        ${isLocal ? `<span>🏛 ${state.name} state codes also apply</span>` : ''}
      </div>
    </div>
    ${statCards}
    ${hierNote}
    ${amendBanner}
    <div class="section-header">
      <span class="section-title">📋 Adopted Code Books</span>
      <span class="section-tag">${codeCount} CODES ON RECORD</span>
    </div>
    <div class="codes-grid">${codes_html}</div>
    ${fireHtml}
    ${stateCodeNote}
    ${footer}
  `;

  rightPanel.innerHTML = html;
  rightPanel.scrollTop = 0;
}

// Initialize
buildTree();
</script>
</body>
</html>
